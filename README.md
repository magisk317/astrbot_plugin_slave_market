# AstrBot 牛马市场插件（Python 版）

基于 [koishi-plugin-slave-market-enhanced](https://github.com/magisk317/koishi-plugin-slave-market-rework) 的玩法，用 Python 为 AstrBot 重写，实现银行、牛马市场、农务、保镖、VIP、红包、监狱等核心系统。插件自动在 `data/slave_market` 下持久化玩家、卡密、红包与备份数据，即使更新或重装插件也不会丢档。

## 主要特性

- **自动注册**：玩家在群里任意发言触发指令即自动建档。
- **经济系统**：打工、抢劫、转账、存取款、领取利息、贷款与信用等级。
- **牛马市场**：购买、强抢、放生与赎身，自动同步身价和排行。
- **农务/保镖/训练**：种植作物、雇佣保镖减免抢劫风险、训练属性并参与决斗、踩缝纫机赚取收益。
- **红包与福利**：发送/抢红包、补助与抽奖玩法，让经济更活跃，上传 `ai.png` 展示赞助二维码。
- **VIP 支持**：内置卡密生成、兑换、时长管理与自动任务开关，后台定时执行自动任务。
- **外观自定义**：玩家可设置称号、签名，展示独特形象。
- **备份安全**：管理员可列出/创建/恢复备份，`重置游戏` 支持一键清档。

## 指令速查

| 分类 | 指令示例 | 说明 |
| --- | --- | --- |
| 基础 | `我的信息` `重开` | 查看角色、重置数据 |
| 信息 | `玩家档案 @昵称` `玩家统计` `查找玩家 霜` `账单 [@人] [数量]` `成就` `玩家指南` | 查询他人战报与成就攻略 |
| 事件 | `今日事件` `黑市竞拍 5000` `猜硬币 500` `掷骰 1000` | 查看限时事件、参与赌局 |
| 经济 | `打工` `抢劫 @昵称 冒险` `存款 1000` | 打工、抢劫、存取款 |
| 银行 | `领取利息` `银行信息` `升级信用` | 银行与信用等级 |
| 交易 | `牛马市场` `购买玩家 @昵称` `放生 @昵称` `赎身` | 牛马相关指令 |
| 转账 | `转账 @昵称 500` `发红包 1000 5` `抢红包 P123` | 转账与红包 |
| 福利 | `领取补助` `抽奖` | 补助与抽奖 |
| 农务 | `种地 西瓜` `收获` `作物状态` | 作物系统 |
| 训练 | `训练 力量` `属性面板` `决斗 @昵称` | 成长与对战 |
| 安保 | `保镖市场` `雇佣保镖 影卫` `保镖状态` | 保镖系统 |
| 监狱 | `踩缝纫机` `监狱状态` `交保出狱` `监狱名单` | 监狱玩法 |
| VIP | `生成vip卡 日卡 3` `vip兑换 <卡密>` `vip状态` | VIP 管理 |
| 商城 | `道具商城` `购买道具 str_potion` `我的道具` `使用道具 str_potion` | 道具与成长 |
| 外观 | `形象` `设置称号 最强王者` `设置签名 勤劳致富` | 个性化展示 |
| 管理 | `备份列表` `立即备份` `恢复备份 <文件>` `重开玩家 @昵称` `禁用牛马` `启用牛马` `重置游戏` | 备份/清档与维护 |
| 概览 | `游戏概览` `系统资金` `税收奖池` | 查看全局经济指标 |

## 开发说明

- 插件核心逻辑位于 `slave_market/` 包，按照业务领域拆分为 `services`、`repository`、`models` 等模块，方便维护和扩展。
- `data/slave_market/state.json` 持久化玩家状态；`data/slave_market/backups/` 存储备份；VIP 卡密和红包均存储在同一份 JSON 中，便于迁移。
- 所有命令的正则由 `SlaveMarketEngine.build_pattern()` 生成，避免遗漏新增指令。
- 常见错误会转换为友好的提示信息，不会中断插件运行。

## 使用方式

1. 将本仓库放置到 AstrBot 插件目录（或使用 `pip install -e` 方式开发）。
2. 在 AstrBot 配置中启用 `slave-market` 插件。
3. 重启 AstrBot，群聊中直接输入上表指令即可游玩。
4. 若需自定义作物、抢劫策略等，可编辑 `slave_market/config.py` 并重新加载插件。

## 贡献

欢迎提交 Issue 或 PR，一同完善 Python 版大牛马时代。
